import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as c}from"./index.Cd_vQiNd.js";function d(a=""){return String(a).trim().replace(/\u200c/g,"").replace(/[ي]/g,"ی").replace(/[ك]/g,"ک").replace(/[۰-۹]/g,i=>String("۰۱۲۳۴۵۶۷۸۹".indexOf(i))).toLowerCase()}function te(a){const i={};for(const n of Object.keys(a||{})){const x=n.trim(),s=a[n];i[x]=typeof s=="string"?s.trim():s}return i}function q(a){if(!a)return null;const n=d(a).replace(/[^\d.-]/g,""),x=parseFloat(n);return Number.isNaN(x)?null:x}function se(a,i){const n=te(a),x=Object.entries(n).map(([N,h])=>[d(N),N,h]),s=N=>{const h=x.find(([O])=>N.every(R=>O.includes(R)));return h?h[1]:null},P=s(["اینتاکد"])||s(["intacode"])||s(["کد","اینتا"])||s(["code"]),m=s(["شرح","فعالیت"])||s(["عنوان","فعالیت"])||s(["activity"])||s(["title"]),f=s(["سود","۱۴۰۲"])||s(["سود","1402"])||s(["سود","۱۴۰۳"])||s(["سود","1403"])||s(["profit","1402"])||s(["profit","1403"])||s(["سود","فعالیت"]),u=s(["نسبت","سود","ناویژه"])||s(["نسبت","سود"])||s(["ضریب","سود"])||s(["margin"]),v=s(["نوع","شغل"])||s(["job","type"])||s(["شغل"])||s(["دسته"]),p=s(["ملاحظات"])||s(["توضیحات"])||s(["یادداشت"]),w=P?n[P]:"",j=m?n[m]:"",B=f?n[f]:"",D=u?n[u]:"",y=v?n[v]:"",S=p?n[p]:"";return{id:`${i}-${d(w)||Math.random().toString(36).slice(2)}`,year:i,intacode:w,title:j,profit:B,margin:D,jobType:y,notes:S,__raw:n}}const ne=()=>{const[a,i]=c.useState(1402),[n,x]=c.useState(""),[s,P]=c.useState({}),[m,f]=c.useState(""),[u,v]=c.useState("all"),[p,w]=c.useState("intacode"),[j,B]=c.useState("asc"),[D,y]=c.useState(1),S=40,[I,N]=c.useState({});c.useEffect(()=>{y(1)},[n,a,u,p,j]),c.useEffect(()=>{if(s[a]){f("");return}const t=`/intacode${a}.json`;fetch(t).then(r=>{if(!r.ok)throw new Error(`خطا در دریافت ${t}`);return r.json()}).then(r=>{let o=[];Array.isArray(r)?o=r:Array.isArray(r?.data)?o=r.data:typeof r=="object"&&(o=Object.values(r)),P(M=>({...M,[a]:o})),f("")}).catch(r=>{console.error(r),f(`خطا در بارگذاری داده‌های سال ${a}. لطفاً فایل /intacode${a}.json را بررسی کنید.`)})},[a,s]);const h=c.useMemo(()=>(s[a]||[]).map(r=>se(r,a)),[s,a]),O=c.useMemo(()=>{const t=new Set;for(const r of h){const o=(r.jobType||"").trim();o&&t.add(o)}return Array.from(t)},[h]),R=t=>{switch(p){case"intacode":return q(t.intacode)??t.intacode;case"title":return t.title||"";case"profit":return q(t.profit);case"margin":return q(t.margin);default:return null}},z=c.useMemo(()=>{const r=d(n).split(/\s+/).filter(Boolean),o=r.length>0;let M=h;u!=="all"&&(M=M.filter(l=>d(l.jobType)===d(u)));let E=M.map(l=>{const F=[d(l.intacode),d(l.title),d(l.jobType),d(l.profit),d(l.margin),d(l.notes)].join(" "),b=o?r.reduce((g,A)=>F.includes(A)?g+1:g,0):0;return{item:l,score:b}});return o&&(E=E.filter(l=>l.score>0)),E.sort((l,F)=>{if(o&&l.score!==F.score)return F.score-l.score;const b=R(l.item),g=R(F.item);if(b==null&&g==null)return 0;if(b==null)return 1;if(g==null)return-1;if(typeof b=="number"&&typeof g=="number")return j==="asc"?b-g:g-b;const A=String(b).localeCompare(String(g),"fa",{numeric:!0,sensitivity:"base"});return j==="asc"?A:-A}),E.map(l=>l.item)},[h,n,u,p,j]),k=z.length,C=Math.max(1,Math.ceil(k/S)),$=Math.min(D,C),L=($-1)*S,J=L+S,K=z.slice(L,J),Y=n.trim().length>1,T=c.useMemo(()=>Object.values(I),[I]),Q=c.useMemo(()=>T.some(t=>t.notes&&t.notes.trim().length>0),[T]),_=t=>{x(t.target.value)},H=t=>{const r=Number(t.target.value);i(r)},G=t=>{v(t.target.value)},U=t=>{w(t.target.value)},W=t=>{B(t.target.value)},V=t=>{N(r=>{if(r[t.id]){const o={...r};return delete o[t.id],o}return{...r,[t.id]:t}})},X=()=>{x(""),v("all"),w("intacode"),B("asc"),y(1)},Z=()=>{y(t=>Math.max(1,t-1))},ee=()=>{y(t=>Math.min(C,t+1))};return e.jsxs("div",{className:"w-full max-w-5xl mx-auto text-right",dir:"rtl",children:[T.length>0&&e.jsxs("section",{className:"mb-6 border border-amber-300 rounded-lg bg-amber-50 dark:bg-slate-800 dark:border-amber-500 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"font-semibold text-sm text-amber-900 dark:text-amber-200",children:"موارد منتخب شما"}),e.jsxs("span",{className:"text-xs text-amber-800 dark:text-amber-300",children:["تعداد: ",T.length]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border border-amber-200 dark:border-amber-500 rounded-md overflow-hidden",children:[e.jsx("thead",{className:"bg-amber-100 dark:bg-amber-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-right",children:"سال"}),e.jsx("th",{className:"p-2 text-right",children:"اینتاکد"}),e.jsx("th",{className:"p-2 text-right",children:"شرح فعالیت"}),e.jsx("th",{className:"p-2 text-right",children:"نوع شغل"}),e.jsx("th",{className:"p-2 text-right whitespace-nowrap",children:"سود فعالیت"}),e.jsx("th",{className:"p-2 text-right whitespace-nowrap",children:"نسبت سود ناویژه"}),Q&&e.jsx("th",{className:"p-2 text-right",children:"ملاحظات"}),e.jsx("th",{className:"p-2 text-right",children:"حذف"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-900",children:T.map(t=>e.jsxs("tr",{className:"border-t border-amber-100 dark:border-amber-700",children:[e.jsx("td",{className:"p-2 text-xs",children:t.year}),e.jsx("td",{className:"p-2 text-xs",children:t.intacode||"—"}),e.jsx("td",{className:"p-2 text-xs",children:t.title||"—"}),e.jsx("td",{className:"p-2 text-xs",children:t.jobType||"—"}),e.jsx("td",{className:"p-2 text-xs",children:t.profit||"—"}),e.jsx("td",{className:"p-2 text-xs",children:t.margin||"—"}),Q&&e.jsx("td",{className:"p-2 text-xs",children:t.notes?t.notes:"—"}),e.jsx("td",{className:"p-2 text-xs",children:e.jsx("button",{type:"button",onClick:()=>V(t),className:"px-2 py-1 rounded bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900/40 dark:text-red-200 text-[11px]",children:"حذف"})})]},t.id))})]})})]}),e.jsxs("section",{className:"mb-4 grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"سال داده‌ها"}),e.jsxs("select",{value:a,onChange:H,className:"w-full border rounded-lg px-2 py-2 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-[#B50000] dark:bg-[#0f172a] dark:text-gray-100 dark:border-gray-700",children:[e.jsx("option",{value:1402,children:"۱۴۰۲"}),e.jsx("option",{value:1403,children:"۱۴۰۳"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"فیلتر نوع شغل"}),e.jsxs("select",{value:u,onChange:G,className:"w-full border rounded-lg px-2 py-2 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-[#B50000] dark:bg-[#0f172a] dark:text-gray-100 dark:border-gray-700",children:[e.jsx("option",{value:"all",children:"همه انواع"}),O.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"مرتب‌سازی بر اساس"}),e.jsxs("select",{value:p,onChange:U,className:"w-full border rounded-lg px-2 py-2 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-[#B50000] dark:bg-[#0f172a] dark:text-gray-100 dark:border-gray-700",children:[e.jsx("option",{value:"intacode",children:"اینتاکد"}),e.jsx("option",{value:"title",children:"شرح فعالیت"}),e.jsx("option",{value:"profit",children:"سود فعالیت"}),e.jsx("option",{value:"margin",children:"نسبت سود ناویژه"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"جهت"}),e.jsxs("select",{value:j,onChange:W,className:"w-full border rounded-lg px-2 py-2 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-[#B50000] dark:bg-[#0f172a] dark:text-gray-100 dark:border-gray-700",children:[e.jsx("option",{value:"asc",children:"صعودی"}),e.jsx("option",{value:"desc",children:"نزولی"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{type:"button",onClick:X,className:"whitespace-nowrap px-3 py-2 rounded-lg text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-gray-100",children:"ریست"})})]})]}),e.jsxs("section",{className:"mb-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"text",placeholder:"جستجو در «شرح فعالیت»، «اینتاکد» یا کلمات مرتبط… (حداقل ۲ کاراکتر)",value:n,onChange:_,className:"w-full border rounded-lg p-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#B50000] dark:bg-[#0f172a] dark:text-gray-100 dark:border-gray-700",dir:"rtl","aria-label":"کادر جستجوی اینتاکد"})}),m&&e.jsx("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:m})]}),Y&&!m&&e.jsx("div",{className:"mb-2 text-xs text-gray-600 dark:text-gray-300",children:k>0?e.jsxs("span",{children:[k.toLocaleString("fa-IR")," نتیجه برای جستجوی"," ",e.jsxs("span",{className:"font-semibold",children:["«",n,"»"]})," در سال"," ",a," یافت شد."]}):e.jsxs("span",{children:["هیچ موردی برای جستجوی «",n,"» در سال ",a," یافت نشد."]})}),Y&&!m&&e.jsx(e.Fragment,{children:k>0?e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"overflow-x-auto border border-gray-300 rounded-lg dark:border-gray-700",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-200 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-right",children:"اینتاکد"}),e.jsx("th",{className:"p-2 text-right",children:"شرح فعالیت"}),e.jsx("th",{className:"p-2 text-right",children:"نوع شغل"}),e.jsxs("th",{className:"p-2 text-right whitespace-nowrap",children:["سود فعالیت ",a]}),e.jsx("th",{className:"p-2 text-right whitespace-nowrap",children:"نسبت سود ناویژه"}),e.jsx("th",{className:"p-2 text-right",children:"منتخب"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-900",children:K.map(t=>{const r=!!I[t.id],o=t.notes&&t.notes.trim().length>0;return e.jsxs("tr",{className:"border-t hover:bg-gray-50 dark:hover:bg-slate-800 dark:border-gray-700",children:[e.jsx("td",{className:"p-2",children:t.intacode||"—"}),e.jsxs("td",{className:"p-2",children:[e.jsx("span",{children:t.title||"—"}),o&&e.jsx("span",{className:"ml-2 inline-block text-[10px] px-2 py-0.5 rounded-full bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-200",title:t.notes,children:"ملاحظات"})]}),e.jsx("td",{className:"p-2",children:t.jobType||"—"}),e.jsx("td",{className:"p-2",children:t.profit||"—"}),e.jsx("td",{className:"p-2",children:t.margin||"—"}),e.jsx("td",{className:"p-2",children:e.jsx("button",{type:"button",onClick:()=>V(t),className:`px-2 py-1 rounded text-xs ${r?"bg-emerald-100 text-emerald-700 hover:bg-emerald-200 dark:bg-emerald-900/40 dark:text-emerald-200":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-slate-700 dark:text-gray-100"}`,children:r?"حذف از منتخب":"افزودن"})})]},t.id)})})]})}),C>1&&e.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-gray-700 dark:text-gray-200",children:[e.jsxs("div",{children:["نمایش"," ",e.jsxs("span",{className:"font-semibold",children:[L+1,"–",Math.min(J,k)]})," ","از"," ",e.jsx("span",{className:"font-semibold",children:k.toLocaleString("fa-IR")})," ","نتیجه"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:Z,disabled:$===1,className:"px-3 py-1 rounded border text-xs disabled:opacity-50 disabled:cursor-not-allowed border-gray-300 hover:bg-gray-100 dark:border-gray-600 dark:hover:bg-slate-700",children:"قبلی"}),e.jsxs("span",{children:["صفحه"," ",e.jsx("span",{className:"font-semibold",children:$})," ","از"," ",e.jsx("span",{className:"font-semibold",children:C})]}),e.jsx("button",{type:"button",onClick:ee,disabled:$===C,className:"px-3 py-1 rounded border text-xs disabled:opacity-50 disabled:cursor-not-allowed border-gray-300 hover:bg-gray-100 dark:border-gray-600 dark:hover:bg-slate-700",children:"بعدی"})]})]})]}):e.jsx("p",{className:"mt-4 text-sm text-gray-600 dark:text-gray-300",children:"هیچ موردی یافت نشد."})}),!Y&&!m&&e.jsx("p",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:"برای نمایش نتایج، حداقل ۲ کاراکتر در کادر جستجو وارد کنید."})]})};export{ne as default};
