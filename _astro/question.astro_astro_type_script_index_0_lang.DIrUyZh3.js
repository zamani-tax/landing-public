const P="989124689983",H="zamani_acc",k="سلام، درباره سوالی که در سایت ثبت کردم پیام می دهم.",N={"۰":"0","۱":"1","۲":"2","۳":"3","۴":"4","۵":"5","۶":"6","۷":"7","۸":"8","۹":"9","٠":"0","١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9"};function B(t){return t?t.replace(/[۰-۹٠-٩]/g,e=>N[e]||e):""}function w(t){return(t||"").replace(/\D+/g,"")}function D(t){return(t||"").replace(/[\س\u00A0\u200C\u200D\u200E\u200F\u061C]+/g,"")}function W(t){const e=w(B(t||""));if(/^09\d{9}$/.test(e))return"98"+e.slice(1);let s=D(B(t||""));return s=s.replace(/^(?:\+?98|0098)\s*/,""),s=w(s),/^9\d{9}$/.test(s)?"98"+s:""}function M(t){let e=D(B(t||""));e=e.replace(/^(?:\+?98|0098)\s*/,"0"),/^9\d{0,10}$/.test(e)&&(e="0"+e),e=w(e),e.length>11&&(e=e.slice(0,11));const s=/^09[0-9]{9}$/.test(e);return{value:e,isValid:s}}function F(t){let e=(t||"").trim();e.startsWith("@")&&(e=e.slice(1)),e=e.replace(/[^\w]/g,"");const s=e.length>=5&&e.length<=32;return{value:e,isValid:s,url:e?"https://t.me/"+e:""}}let C=!1,m=null;const $=800;function x(){C=!0,m&&clearTimeout(m),m=setTimeout(()=>{C=!1,m=null},$)}function O(t,e){const s=document.createElement("a");return s.href=t,s.target="_blank",s.rel="noopener",s.className="inline-block text-center bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded",s.textContent=e,s}function A(){const t=document.getElementById("askForm");if(!(t instanceof HTMLFormElement))return;const e=document.getElementById("feedback");if(!(e instanceof HTMLElement))return;const s=t.querySelector('button[type="submit"]');if(!(s instanceof HTMLButtonElement))return;const a=document.getElementById("mobile"),q=document.getElementById("name"),o=document.getElementById("email"),R=document.getElementById("message"),T=t.querySelector("#page_url"),v=t.querySelector("#whatsapp_url"),y=t.querySelector("#telegram_url");T&&(T.value=location.href);const b=document.getElementById("postSubmitCtas"),h=document.getElementById("ctaButtons"),L=document.getElementById("tgFallback"),E=document.getElementById("copyHelloBtn"),S=document.getElementById("tgWebLink");function g(n,i=!0){e.textContent=n,e.className="mt-3 text-sm "+(i?"text-green-400":"text-red-400")}const u={required:"این فیلد را پر کنید.",mobileFormat:"شماره موبایل باید 11 رقم و با 09 شروع شود.",needOne:"حداقل یکی از واتساپ یا تلگرام را وارد کنید.",tgFormat:"آیدی تلگرام را به شکل صحیح وارد کنید. مثلا @username",generalFail:"ارسال انجام نشد. لطفا بعدا دوباره تلاش کنید.",network:"خطای شبکه — اتصال اینترنت یا سرور را بررسی کنید."};function I(n,i){n instanceof HTMLElement&&(n.addEventListener("invalid",d=>{const f=i?i(n):u.required;n.setCustomValidity(f),C&&(d.preventDefault(),d.stopImmediatePropagation())}),n.addEventListener("input",()=>{n.setCustomValidity(""),x(),n.value&&!n.checkValidity()?n.classList.add("border-red-500"):n.classList.remove("border-red-500")}),n.addEventListener("blur",()=>{if(n.setCustomValidity(""),!n.checkValidity()){const d=i?i(n):u.required;n.setCustomValidity(d)}}))}if(I(q,()=>u.required),I(R,()=>u.required),a instanceof HTMLInputElement){I(a,()=>u.mobileFormat);const n=()=>{const{value:i,isValid:d}=M(a.value);a.value!==i&&(a.value=i),a.setCustomValidity(""),x(),a.value.length>0&&!d?a.classList.add("border-red-500"):a.classList.remove("border-red-500")};a.addEventListener("input",n),a.addEventListener("blur",n)}if(o instanceof HTMLInputElement){o.removeAttribute("type"),o.setAttribute("type","text"),I(o,()=>u.tgFormat);const n=()=>{const{value:i}=F(o.value);o.value!==i&&"@"+i!==o.value&&(o.value=i?"@"+i:""),o.setCustomValidity(""),x()};o.addEventListener("input",n),o.addEventListener("blur",n)}t.addEventListener("submit",async n=>{n.preventDefault(),m&&(clearTimeout(m),m=null),C=!1;let i=!1,d="";if(a instanceof HTMLInputElement&&a.value){const c=M(a.value);if(a.value=c.value,a.setCustomValidity(""),c.isValid){i=!0;const l=W(c.value);if(l){const p=encodeURIComponent("سلام، درباره سوال مالیاتی پیام دادم.");d="https://wa.me/"+l+"?text="+p}}else i=!1}let f=!1,V="";if(o instanceof HTMLInputElement&&o.value){const c=o.value.startsWith("@")?o.value.slice(1):o.value,l=F(c);l.value&&(f=!0,V=l.url,o.value="@"+l.value)}if(!i&&!f){g(u.needOne,!1),a&&(a.focus(),a.setCustomValidity(u.needOne),a.reportValidity());return}if(!t.checkValidity()){t.reportValidity();return}v&&(v.value=d||""),y&&(y.value=V||"");const _=new FormData(t);T||_.set("page_url",location.href);const U=s.textContent||"ثبت سوال";s.disabled=!0,s.textContent="در حال ثبت...",g("");try{const c=await fetch("https://teloox.ir/forms.php",{method:"POST",body:_});let l=c.ok,p="";if((c.headers.get("content-type")||"").includes("application/json"))try{const r=await c.json();typeof r?.message=="string"&&(p=r.message),typeof r?.success=="boolean"&&(l=l&&r.success),typeof r?.ok=="boolean"&&(l=l&&r.ok)}catch{}else if(!l)try{p=(await c.text()).slice(0,200)}catch{}if(l){if(g(p||"سوال شما با موفقیت ثبت شد.",!0),t.reset(),v&&(v.value=""),y&&(y.value=""),h&&(h.innerHTML=""),L&&L.classList.add("hidden"),i){const r="https://wa.me/"+P+"?text="+encodeURIComponent(k);h.appendChild(O(r,"شروع گفتگو در واتساپ"))}if(f){const r="tg://resolve?domain="+H+"&text="+encodeURIComponent(k);h.appendChild(O(r,"شروع گفتگو در تلگرام")),L&&S&&E&&(S.href="https://t.me/"+H,L.classList.remove("hidden"),E.onclick=async()=>{try{await navigator.clipboard.writeText(k),E.textContent="کپی شد!",setTimeout(()=>E.textContent="کپی سلام",1500)}catch{}})}i||f?b&&b.classList.remove("hidden"):b&&b.classList.add("hidden")}else{g(p||u.generalFail,!1);const r=document.getElementById("postSubmitCtas");r&&r.classList.add("hidden")}}catch{g(u.network,!1);const l=document.getElementById("postSubmitCtas");l&&l.classList.add("hidden")}finally{s.disabled=!1,s.textContent=U}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",A,{once:!0}):A();
