const W="989124689983",H="zamani_acc",z={"۰":"0","۱":"1","۲":"2","۳":"3","۴":"4","۵":"5","۶":"6","۷":"7","۸":"8","۹":"9","٠":"0","١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9"};function x(t){return t?t.replace(/[۰-۹٠-٩]/g,e=>z[e]||e):""}function w(t){return(t||"").replace(/\D+/g,"")}function O(t){return(t||"").replace(/[\س\u00A0\u200C\u200D\u200E\u200F\u061C]+/g,"")}function $(t){const e=w(x(t||""));if(/^09\d{9}$/.test(e))return"98"+e.slice(1);let s=O(x(t||""));return s=s.replace(/^(?:\+?98|0098)\s*/,""),s=w(s),/^9\d{9}$/.test(s)?"98"+s:""}function M(t){let e=O(x(t||""));e=e.replace(/^(?:\+?98|0098)\s*/,"0"),/^9\d{0,10}$/.test(e)&&(e="0"+e),e=w(e),e.length>11&&(e=e.slice(0,11));const s=/^09[0-9]{9}$/.test(e);return{value:e,isValid:s}}function R(t){let e=(t||"").trim();e.startsWith("@")&&(e=e.slice(1)),e=e.replace(/[^\w]/g,"");const s=e.length>=5&&e.length<=32;return{value:e,isValid:s,url:e?"https://t.me/"+e:""}}let L=!1,m=null;const j=800;function T(){L=!0,m&&clearTimeout(m),m=setTimeout(()=>{L=!1,m=null},j)}function A(t,e){const s=document.createElement("a");return s.href=t,s.target="_blank",s.rel="noopener",s.className="inline-block text-center bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded",s.textContent=e,s}function D(){const t=document.getElementById("askForm");if(!(t instanceof HTMLFormElement))return;const e=document.getElementById("feedback"),s=t.querySelector('button[type="submit"]'),a=document.getElementById("mobile"),q=document.getElementById("name"),o=document.getElementById("email"),B=document.getElementById("message"),E=t.querySelector("#page_url"),g=t.querySelector("#whatsapp_url"),v=t.querySelector("#telegram_url");E&&(E.value=location.href);const S=document.getElementById("postSubmitCtas"),y=document.getElementById("ctaButtons"),b=document.getElementById("tgFallback"),h=document.getElementById("copyHelloBtn"),V=document.getElementById("tgWebLink");function p(n,i=!0){e&&(e.textContent=n,e.className="mt-3 text-sm "+(i?"text-green-400":"text-red-400"))}const c={required:"این فیلد را پر کنید.",mobileFormat:"شماره موبایل باید 11 رقم و با 09 شروع شود.",needOne:"حداقل یکی از واتساپ یا تلگرام را وارد کنید.",tgFormat:"آیدی تلگرام را به شکل صحیح وارد کنید. مثلا @username",generalFail:"ارسال انجام نشد. لطفا بعدا دوباره تلاش کنید.",network:"خطای شبکه — اتصال اینترنت یا سرور را بررسی کنید."};function I(n,i){n instanceof HTMLElement&&(n.addEventListener("invalid",d=>{const C=i?i(n):c.required;n.setCustomValidity(C),L&&(d.preventDefault(),d.stopImmediatePropagation())}),n.addEventListener("input",()=>{n.setCustomValidity(""),T(),n.value&&!n.checkValidity()?n.classList.add("border-red-500"):n.classList.remove("border-red-500")}),n.addEventListener("blur",()=>{if(n.setCustomValidity(""),!n.checkValidity()){const d=i?i(n):c.required;n.setCustomValidity(d)}}))}if(I(q,()=>c.required),I(B,()=>c.required),a instanceof HTMLInputElement){I(a,()=>c.mobileFormat);const n=()=>{const{value:i,isValid:d}=M(a.value);a.value!==i&&(a.value=i),a.setCustomValidity(""),T(),a.value.length>0&&!d?a.classList.add("border-red-500"):a.classList.remove("border-red-500")};a.addEventListener("input",n),a.addEventListener("blur",n)}if(o instanceof HTMLInputElement){o.removeAttribute("type"),o.setAttribute("type","text"),I(o,()=>c.tgFormat);const n=()=>{const{value:i}=R(o.value);o.value!==i&&"@"+i!==o.value&&(o.value=i?"@"+i:""),o.setCustomValidity(""),T()};o.addEventListener("input",n),o.addEventListener("blur",n)}t.addEventListener("submit",async n=>{n.preventDefault(),m&&(clearTimeout(m),m=null),L=!1;let i=!1,d="";if(a instanceof HTMLInputElement&&a.value){const r=M(a.value);if(a.value=r.value,a.setCustomValidity(""),r.isValid){i=!0;const l=$(r.value);if(l){const f=encodeURIComponent("سلام، درباره سوال مالیاتی پیام دادم.");d="https://wa.me/"+l+"?text="+f}}}let C=!1,_="";if(o instanceof HTMLInputElement&&o.value){const r=o.value.startsWith("@")?o.value.slice(1):o.value,l=R(r);l.value&&(C=!0,_=l.url,o.value="@"+l.value)}if(!i&&!C){p(c.needOne,!1),a&&(a.focus(),a.setCustomValidity(c.needOne),a.reportValidity());return}if(!t.checkValidity()){t.reportValidity();return}g&&(g.value=d||""),v&&(v.value=_||"");const F=new FormData(t);E||F.set("page_url",location.href);const U=s.textContent||"ثبت سوال";s.disabled=!0,s.textContent="در حال ثبت...",p("");try{const r=await fetch("https://agentbot.zamani.tax/forms.php",{method:"POST",body:F});let l=r.ok,f="";if((r.headers.get("content-type")||"").includes("application/json"))try{const u=await r.json();typeof u?.message=="string"&&(f=u.message),typeof u?.success=="boolean"&&(l=l&&u.success),typeof u?.ok=="boolean"&&(l=l&&u.ok)}catch{}else if(!l)try{f=(await r.text()).slice(0,200)}catch{}if(l){p(f||"سوال شما با موفقیت ثبت شد.",!0),t.reset(),g&&(g.value=""),v&&(v.value=""),y&&(y.innerHTML=""),b&&b.classList.add("hidden");const k=`سلام، درباره سوالی که در سایت ثبت کردم پیام می دم:

`+(B?.value?.trim()||""),P="https://wa.me/"+W+"?text="+encodeURIComponent(k);y.appendChild(A(P,"شروع گفتگو در واتساپ"));const N="tg://resolve?domain="+H+"&text="+encodeURIComponent(k);y.appendChild(A(N,"شروع گفتگو در تلگرام")),b&&V&&h&&(V.href="https://t.me/"+H,b.classList.remove("hidden"),h.onclick=async()=>{try{await navigator.clipboard.writeText(k),h.textContent="کپی شد!",setTimeout(()=>h.textContent="کپی سلام",1500)}catch{}}),S&&S.classList.remove("hidden")}else{p(f||c.generalFail,!1);const u=document.getElementById("postSubmitCtas");u&&u.classList.add("hidden")}}catch{p(c.network,!1);const l=document.getElementById("postSubmitCtas");l&&l.classList.add("hidden")}finally{s.disabled=!1,s.textContent=U}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",D,{once:!0}):D();
