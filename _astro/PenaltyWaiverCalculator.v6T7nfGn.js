import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as f}from"./index.RH_Wq4ov.js";const R=s=>s.replace(/[\u06F0-\u06F9]/g,c=>String(c.charCodeAt(0)-1776)).replace(/[\u0660-\u0669]/g,c=>String(c.charCodeAt(0)-1632)).replace(/[^0-9]/g,""),h=s=>{const c=Number(R(s));return Number.isFinite(c)?c:0},D=({children:s})=>e.jsx("table",{className:"w-full text-sm border-separate [border-spacing:0] rounded-2xl overflow-hidden",children:e.jsx("tbody",{className:"divide-y divide-gray-800/50 border border-gray-800/50",children:s})}),l=({children:s})=>e.jsx("tr",{className:"even:bg-muted/20",children:s}),t=({children:s})=>e.jsx("td",{className:"w-1/3 p-3 align-middle text-right text-muted-foreground",children:s}),r=({children:s})=>e.jsx("td",{className:"w-2/3 p-3 align-middle",children:s}),o=s=>e.jsx("input",{...s,className:`w-full rounded-xl border border-gray-700/50 bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500/50 ${s.className||""}`}),g=s=>e.jsx("select",{...s,className:`w-full rounded-xl border border-gray-700/50 bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500/50 ${s.className||""}`}),u=({checked:s,onChange:c,label:a})=>e.jsxs("button",{type:"button",onClick:()=>c(!s),className:`inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs border ${s?"bg-blue-600/20 border-blue-600/50":"bg-transparent border-gray-700/40"}`,children:[e.jsx("span",{className:`h-3 w-3 rounded-full ${s?"bg-blue-500":"bg-gray-500"}`}),a&&e.jsx("span",{className:"text-muted-foreground",children:a})]}),M=()=>{const[s,c]=f.useState({taxKind:"DIRECT",isVatBandB:!1,periodYear:1403,periodSeason:"بهار",assessmentNoticeDate:"",finalAssessmentDate:"",execWritDate:"",payOrPlanDate:"",stages:{badavi:!1,tajdid:!1,m251:!1,divan:!1},has30PercentReduction:!1,settlementType:"FULL",personType:"NATURAL",hasCriminalComplaint:!1,indictmentIssued:!1,hasPast5yConviction:!1,principal:0,penaltiesWaivableRaw:0,penaltiesNonWaivable:0,refundInterestConfirmed:0,installmentsCount:void 0}),a=(n,i)=>c(x=>({...x,[n]:i})),j=(n,i)=>c(x=>({...x,stages:{...x.stages,[n]:i}})),m=f.useMemo(()=>Object.values(s.stages).filter(Boolean).length,[s.stages]),d=f.useMemo(()=>{let n=0;s.periodYear>=1403?n=100:s.periodYear===1402?n=95:s.periodYear===1401?n=85:s.periodYear===1400?n=75:n=65;const i=[];s.taxKind==="VAT"&&s.isVatBandB&&s.periodYear>=1403&&(n=Math.max(n-10,0),i.push({label:"کسر ویژه VAT بند «ب» (بند 1-3)",valuePP:10,ref:"1-3"})),m>0&&!s.has30PercentReduction&&i.push({label:"کسر بابت مراحل دادرسی (۵pp برای هر مرحله) (۱-۱)",valuePP:5*m,ref:"1-1"});const x=Math.max(n-i.reduce((S,k)=>S+k.valuePP,0),0),b=s.settlementType==="FULL"?30:20,v=Math.max(x,b),T=Math.max(s.penaltiesWaivableRaw-s.refundInterestConfirmed,0),p=[];return s.hasCriminalComplaint&&(s.indictmentIssued?p.push("اعلام جرم و صدور کیفرخواست: خارج از شمول (بند ۷)"):s.hasPast5yConviction?p.push("اعلام جرم بدون کیفرخواست اما دارای محکومیت ۵ساله: احتمال پذیرش پایین (بند ۷)"):p.push("اعلام جرم بدون کیفرخواست و بدون محکومیت ۵ساله: امکان اعمال با تشخیص اداره کل (بند ۷)")),p.push("تاریخ اجرا از ۱۴۰۴/۰۸/۰۱. قبل از آن، مزایای ۲۰۰/۱۴۰۲/۵۱۵۱۰ را هم بسنجید"),{baseCapPercent:n,deductions:i,afterAllDeductionsPercent:x,floorAppliedPercent:v===b?b:void 0,finalCapPercent:v,penaltiesBaseAfterRefund:T,waiverAmount:0,warnings:p,notes:["خروجی ها حداکثر قابل اعطا هستند؛ تصمیم نهایی با اداره کل طبق ماده ۱۹۱","هزینه رسیدگی ماده ۲۴۷ جریمه نیست و مشمول بخشودگی نمی شود","سقف سیستمی: حقیقی ۱میلیارد / حقوقی ۳میلیارد ریال (هر سال/دوره)","در تقسیط، اصل بدهی و جرایم غیرقابل بخشش و باقیمانده جرایم هم زمان تقسیط و هر قسط به تناسب سرشکن شود"]}},[s,m]),C=s.taxKind==="VAT",N=s.taxKind==="VAT",y=s.periodYear>=1400,A=s.periodYear<=1399,P=s.settlementType==="INSTALLMENT",w=s.hasCriminalComplaint;return e.jsxs("div",{className:"rounded-2xl border border-gray-700/50 bg-card p-4 md:p-6",dir:"rtl",children:[e.jsxs(D,{children:[e.jsxs(l,{children:[e.jsx(t,{children:"نوع مالیات"}),e.jsx(r,{children:e.jsxs(g,{value:s.taxKind,onChange:n=>a("taxKind",n.target.value),children:[e.jsx("option",{value:"DIRECT",children:"مالیات های مستقیم"}),e.jsx("option",{value:"VAT",children:"ارزش افزوده (VAT)"})]})})]}),e.jsxs(l,{children:[e.jsx(t,{children:"سال/دوره"}),e.jsx(r,{children:e.jsx(o,{type:"text",inputMode:"numeric",placeholder:"مثلا ۱۴۰۳",value:String(s.periodYear),onChange:n=>a("periodYear",h(n.target.value))})})]}),N&&e.jsxs(l,{children:[e.jsx(t,{children:"فصل (اختیاری برای VAT)"}),e.jsx(r,{children:e.jsxs(g,{value:s.periodSeason,onChange:n=>a("periodSeason",n.target.value),children:[e.jsx("option",{value:"بهار",children:"بهار"}),e.jsx("option",{value:"تابستان",children:"تابستان"}),e.jsx("option",{value:"پاییز",children:"پاییز"}),e.jsx("option",{value:"زمستان",children:"زمستان"})]})})]}),C&&e.jsxs(l,{children:[e.jsx(t,{children:"بند «ب» ماده ۳۶ (بهار ۱۴۰۳ به بعد)"}),e.jsx(r,{children:e.jsx(u,{checked:s.isVatBandB,onChange:n=>a("isVatBandB",n)})})]}),y&&e.jsxs(l,{children:[e.jsx(t,{children:"تاریخ ابلاغ برگ تشخیص (۱۴۰۰+)"}),e.jsx(r,{children:e.jsx(o,{type:"text",placeholder:"مثلا ۱۴۰۲/۱۲/۲۸",value:s.assessmentNoticeDate||"",onChange:n=>a("assessmentNoticeDate",n.target.value)})})]}),A&&e.jsxs(l,{children:[e.jsx(t,{children:"تاریخ ابلاغ برگ قطعی (۱۳۹۹ و قبل)"}),e.jsx(r,{children:e.jsx(o,{type:"text",placeholder:"مثلا ۱۳۹۸/۱۰/۱۵",value:s.finalAssessmentDate||"",onChange:n=>a("finalAssessmentDate",n.target.value)})})]}),e.jsxs(l,{children:[e.jsx(t,{children:"تاریخ ابلاغ برگ اجرایی (۱-۲)"}),e.jsx(r,{children:e.jsx(o,{type:"text",placeholder:"مثلا ۱۴۰۴/۰۴/۲۵",value:s.execWritDate||"",onChange:n=>a("execWritDate",n.target.value)})})]}),e.jsxs(l,{children:[e.jsx(t,{children:"تاریخ پرداخت/ثبت ترتیب پرداخت"}),e.jsx(r,{children:e.jsx(o,{type:"text",placeholder:"مثلا ۱۴۰۴/۰۵/۱۰",value:s.payOrPlanDate||"",onChange:n=>a("payOrPlanDate",n.target.value)})})]}),e.jsxs(l,{children:[e.jsx(t,{children:"مراحل دادرسی طی شده تا قبل از پرداخت/تقسیط (۱-۱)"}),e.jsxs(r,{children:[e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"accent-blue-600",checked:s.stages.badavi,onChange:n=>j("badavi",n.target.checked)}),e.jsx("span",{children:"هیات بدوی"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"accent-blue-600",checked:s.stages.tajdid,onChange:n=>j("tajdid",n.target.checked)}),e.jsx("span",{children:"هیات تجدیدنظر"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"accent-blue-600",checked:s.stages.m251,onChange:n=>j("m251",n.target.checked)}),e.jsx("span",{children:"۲۵۱ مکرر"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"accent-blue-600",checked:s.stages.divan,onChange:n=>j("divan",n.target.checked)}),e.jsx("span",{children:"دیوان عدالت اداری"})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:["تعداد مراحل انتخاب شده: ",e.jsx("span",{className:"font-mono",children:m})]})]})]}),e.jsxs(l,{children:[e.jsx(t,{children:"در دادرسی ≥ ۳۰٪ کاهش نسبت به برگ تشخیص رخ داده؟ (استثنا بند ۱-۱)"}),e.jsx(r,{children:e.jsx(u,{checked:s.has30PercentReduction,onChange:n=>a("has30PercentReduction",n)})})]}),e.jsxs(l,{children:[e.jsx(t,{children:"نوع تسویه"}),e.jsx(r,{children:e.jsxs(g,{value:s.settlementType,onChange:n=>a("settlementType",n.target.value),children:[e.jsx("option",{value:"FULL",children:"پرداخت یکجا"}),e.jsx("option",{value:"INSTALLMENT",children:"تقسیط (ترتیب پرداخت)"})]})})]}),P&&e.jsxs(l,{children:[e.jsx(t,{children:"تعداد اقساط (تقسیط)"}),e.jsx(r,{children:e.jsx(o,{type:"text",inputMode:"numeric",value:s.installmentsCount?String(s.installmentsCount):"",onChange:n=>a("installmentsCount",n.target.value?h(n.target.value):void 0),placeholder:"مثلا ۱۲"})})]}),e.jsxs(l,{children:[e.jsx(t,{children:"اعلام جرم برای همین سال/دوره؟ (بند ۷)"}),e.jsx(r,{children:e.jsx(u,{checked:s.hasCriminalComplaint,onChange:n=>a("hasCriminalComplaint",n)})})]}),w&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{children:[e.jsx(t,{children:"کیفرخواست صادر شده؟"}),e.jsx(r,{children:e.jsx(u,{checked:s.indictmentIssued,onChange:n=>a("indictmentIssued",n)})})]}),e.jsxs(l,{children:[e.jsx(t,{children:"محکومیت قطعی در ۵ سال گذشته؟"}),e.jsx(r,{children:e.jsx(u,{checked:s.hasPast5yConviction,onChange:n=>a("hasPast5yConviction",n)})})]})]}),e.jsxs(l,{children:[e.jsx(t,{children:"نوع مودی (سقف سیستمی)"}),e.jsx(r,{children:e.jsxs(g,{value:s.personType,onChange:n=>a("personType",n.target.value),children:[e.jsx("option",{value:"NATURAL",children:"حقیقی"}),e.jsx("option",{value:"LEGAL",children:"حقوقی"})]})})]}),e.jsxs(l,{children:[e.jsx(t,{children:"اصل بدهی (ریال)"}),e.jsx(r,{children:e.jsx(o,{type:"text",inputMode:"numeric",value:s.principal?String(s.principal):"",onChange:n=>a("principal",h(n.target.value))})})]}),e.jsxs(l,{children:[e.jsx(t,{children:"جرایم قابل بخشش خام (ریال)"}),e.jsx(r,{children:e.jsx(o,{type:"text",inputMode:"numeric",value:s.penaltiesWaivableRaw?String(s.penaltiesWaivableRaw):"",onChange:n=>a("penaltiesWaivableRaw",h(n.target.value))})})]}),e.jsxs(l,{children:[e.jsx(t,{children:"جرایم غیرقابل بخشش (ریال)"}),e.jsx(r,{children:e.jsx(o,{type:"text",inputMode:"numeric",value:s.penaltiesNonWaivable?String(s.penaltiesNonWaivable):"",onChange:n=>a("penaltiesNonWaivable",h(n.target.value))})})]}),e.jsxs(l,{children:[e.jsx(t,{children:"خسارت تاخیر استرداد تاییدشده (بند ۸) – ریال"}),e.jsx(r,{children:e.jsx(o,{type:"text",inputMode:"numeric",value:s.refundInterestConfirmed?String(s.refundInterestConfirmed):"",onChange:n=>a("refundInterestConfirmed",h(n.target.value))})})]})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-2xl border border-gray-700/50 p-4",children:[e.jsx("h3",{className:"font-bold mb-3",children:"خلاصه محاسبات (پیش نمایش)"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{children:["سقف پایه: ",d.baseCapPercent,"%"]}),d.deductions.map((n,i)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:n.label}),e.jsxs("span",{className:"font-mono",children:["-",n.valuePP,"pp"]})]},i)),e.jsxs("li",{className:"pt-2 border-t border-gray-700/40",children:["پس از کسرها: ",d.afterAllDeductionsPercent,"%"]}),d.floorAppliedPercent!==void 0&&e.jsxs("li",{className:"text-amber-400",children:["اعمال کف: ",d.floorAppliedPercent,"%"]}),e.jsxs("li",{className:"font-bold",children:["درصد نهایی حداکثر بخشودگی: ",d.finalCapPercent,"%"]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-700/50 p-4",children:[e.jsx("h3",{className:"font-bold mb-3",children:"مبنای جریمه و خروجی ریالی"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{children:["مبنای جرایم پس از کسر خسارت استرداد (بند ۸): "," ",e.jsx("span",{className:"font-mono",children:d.penaltiesBaseAfterRefund.toLocaleString("fa-IR")})," ریال"]}),e.jsxs("li",{children:["جمع بخشودگی (ریال): "," ",e.jsx("span",{className:"font-mono",children:d.waiverAmount.toLocaleString("fa-IR")})]})]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6 text-sm",children:[e.jsxs("div",{className:"rounded-2xl border border-amber-700/50 bg-amber-950/20 p-4",children:[e.jsx("h4",{className:"font-bold mb-2",children:"هشدارها / استثناها"}),e.jsx("ul",{className:"list-disc pr-4 space-y-1",children:d.warnings.map((n,i)=>e.jsx("li",{children:n},i))})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-700/50 p-4",children:[e.jsx("h4",{className:"font-bold mb-2",children:"نکات اجرایی"}),e.jsx("ul",{className:"list-disc pr-4 space-y-1",children:d.notes.map((n,i)=>e.jsx("li",{children:n},i))})]})]}),e.jsx("div",{className:"mt-8 flex items-center justify-end",children:e.jsx("button",{type:"button",className:"rounded-xl bg-blue-600/90 px-5 py-2 text-sm font-bold hover:bg-blue-600 transition",onClick:()=>{},children:"محاسبه (نسخه آزمایشی)"})})]})};export{M as default};
