import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.Cd_vQiNd.js";function d(n=""){return String(n).trim().replace(/\u200c/g,"").replace(/[ي]/g,"ی").replace(/[ك]/g,"ک").replace(/[۰-۹]/g,h=>String("۰۱۲۳۴۵۶۷۸۹".indexOf(h))).toLowerCase()}function o(n){return n==null?"—":String(n).replace(/\d/g,h=>"۰۱۲۳۴۵۶۷۸۹"[parseInt(h,10)])}function ue(n){const h={};for(const l of Object.keys(n||{})){const u=l.trim(),s=n[l];h[u]=typeof s=="string"?s.trim():s}return h}function V(n){if(!n)return null;const l=d(n).replace(/[^\d.-]/g,""),u=parseFloat(l);return Number.isNaN(u)?null:u}function be(n,h){const l=ue(n),u=Object.entries(l).map(([T,j])=>[d(T),T,j]),s=T=>{const j=u.find(([R])=>T.every(_=>R.includes(_)));return j?j[1]:null},z=s(["اینتاکد"])||s(["intacode"])||s(["کد","اینتا"])||s(["code"]),p=s(["شرح","فعالیت"])||s(["عنوان","فعالیت"])||s(["activity"])||s(["title"]),v=s(["سود","۱۴۰۲"])||s(["سود","1402"])||s(["سود","۱۴۰۳"])||s(["سود","1403"])||s(["profit","1402"])||s(["profit","1403"])||s(["سود","فعالیت"]),f=s(["نسبت","سود","ناویژه"])||s(["نسبت","سود"])||s(["ضریب","سود"])||s(["margin"]),P=s(["نوع","شغل"])||s(["job","type"])||s(["شغل"])||s(["دسته"]),y=s(["نوع","بازرگانی"])||s(["بازرگانی"])||s(["business"]),M=s(["نوع","کالا"])||s(["کالا"])||s(["goods"]),N=s(["ملاحظات"])||s(["توضیحات"])||s(["یادداشت"]),O=z?l[z]:"",w=p?l[p]:"",F=v?l[v]:"",k=f?l[f]:"",D=P?l[P]:"",G=y?l[y]:"",S=M?l[M]:"",E=N?l[N]:"";return{id:`${h}-${d(O)||Math.random().toString(36).slice(2)}`,year:h,intacode:O,title:w,profit:F,margin:k,jobType:D,businessType:G,goodsType:S,notes:E,__raw:l}}const pe=["بازرگانی","تولیدی","خدماتی"],je=["خرده فروشی","عمده فروشی","صادرات","واردات"],fe=["تولید داخل","وارداتی"],ke=()=>{const[n,h]=i.useState(1403),[l,u]=i.useState(""),[s,z]=i.useState({}),[p,v]=i.useState(""),[f,P]=i.useState({بازرگانی:!0,تولیدی:!0,خدماتی:!0}),[y,M]=i.useState({"خرده فروشی":!1,"عمده فروشی":!1,صادرات:!1,واردات:!1}),[N,O]=i.useState({"تولید داخل":!0,وارداتی:!0}),[w,F]=i.useState("intacode"),[k,D]=i.useState("asc"),[G,S]=i.useState(1),E=40,[J,T]=i.useState(!1),[j,R]=i.useState({}),[_,se]=i.useState(null);i.useEffect(()=>{S(1)},[l,n,f,w,k,y,N]),i.useEffect(()=>{if(s[n]){v("");return}const t=`/intacode${n}.json`;fetch(t).then(a=>{if(!a.ok)throw new Error(`خطا در دریافت ${t}`);return a.json()}).then(a=>{let c=[];Array.isArray(a)?c=a:Array.isArray(a?.data)?c=a.data:typeof a=="object"&&(c=Object.values(a)),z(b=>({...b,[n]:c})),v("")}).catch(a=>{console.error(a),v(`خطا در بارگذاری داده‌های سال ${n}. لطفاً فایل /intacode${n}.json را بررسی کنید.`)})},[n,s]);const K=i.useMemo(()=>(s[n]||[]).map(a=>be(a,n)),[s,n]),L=t=>{switch(w){case"intacode":return V(t.intacode)??t.intacode;case"title":return t.title||"";case"profit":return V(t.profit);case"margin":return V(t.margin);default:return null}},U=i.useMemo(()=>{const a=d(l).split(/\s+/).filter(Boolean),c=a.length>0;let b=K;const Z=new Set(Object.entries(f).filter(([,r])=>r).map(([r])=>d(r)));b=b.filter(r=>{const g=d(r.jobType);return!g||Z.size===0?!0:Z.has(g)});const ee=new Set(Object.entries(y).filter(([,r])=>r).map(([r])=>d(r)));if(ee.size>0){const r=d("بازرگانی");b=b.filter(g=>{if(d(g.jobType)!==r)return!0;const x=d(g.businessType);return x?!ee.has(x):!0})}const te=new Set(Object.entries(N).filter(([,r])=>r).map(([r])=>d(r)));b=b.filter(r=>{const g=d(r.jobType),m=d("بازرگانی");if(g!==m)return!0;const x=d(r.goodsType);return!x||te.size===0?!0:te.has(x)});let $=b.map(r=>{const g=[d(r.intacode),d(r.title),d(r.jobType),d(r.businessType),d(r.goodsType),d(r.profit),d(r.margin),d(r.notes)].join(" "),m=c?a.reduce((x,A)=>g.includes(A)?x+1:x,0):0;return{item:r,score:m}});return c&&($=$.filter(r=>r.score>0)),$.sort((r,g)=>{if(c&&r.score!==g.score)return g.score-r.score;const m=L(r.item),x=L(g.item);if(m==null&&x==null)return 0;if(m==null)return 1;if(x==null)return-1;if(typeof m=="number"&&typeof x=="number")return k==="asc"?m-x:x-m;const A=String(m).localeCompare(String(x),"fa",{numeric:!0,sensitivity:"base"});return k==="asc"?A:-A}),$.map(r=>r.item)},[K,l,f,w,k,y,N]),C=U.length,I=Math.max(1,Math.ceil(C/E)),Y=Math.min(G,I),H=(Y-1)*E,W=H+E,re=U.slice(H,W),q=l.trim().length>1,B=i.useMemo(()=>Object.values(j),[j]),X=i.useMemo(()=>B.some(t=>t.notes&&t.notes.trim().length>0),[B]),ae=t=>{u(t.target.value)},ne=t=>{const a=Number(t.target.value);h(a)},le=t=>{F(t.target.value)},de=t=>{D(t.target.value)},Q=t=>{R(a=>{if(a[t.id]){const c={...a};return delete c[t.id],c}return{...a,[t.id]:t}})},oe=()=>{u(""),F("intacode"),D("asc"),P({بازرگانی:!0,تولیدی:!0,خدماتی:!0}),M({"خرده فروشی":!1,"عمده فروشی":!1,صادرات:!1,واردات:!1}),O({"تولید داخل":!0,وارداتی:!0}),S(1)},ce=()=>{S(t=>Math.max(1,t-1))},ie=()=>{S(t=>Math.min(I,t+1))},xe=t=>a=>{P(c=>({...c,[t]:a.target.checked}))},ge=t=>a=>{M(c=>({...c,[t]:a.target.checked}))},he=t=>a=>{O(c=>({...c,[t]:a.target.checked}))},me=t=>{se(a=>a===t?null:t)};return e.jsxs("div",{className:"w-full max-w-5xl mx-auto text-right",dir:"rtl",children:[B.length>0&&e.jsxs("section",{className:"mb-6 border border-amber-300 rounded-lg bg-amber-50 dark:bg-slate-800 dark:border-amber-500 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"font-semibold text-sm text-amber-900 dark:text-amber-200",children:"موارد منتخب شما"}),e.jsxs("span",{className:"text-xs text-amber-800 dark:text-amber-300",children:["تعداد: ",o(B.length)]})]}),e.jsx("div",{className:"block md:hidden space-y-2",children:B.map(t=>e.jsxs("div",{className:"border border-amber-200 dark:border-amber-500 rounded-md bg-white dark:bg-slate-900 p-2 text-[11px]",children:[e.jsx("div",{className:"font-medium text-amber-900 dark:text-amber-100 mb-1",children:t.title||"—"}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1 text-amber-900/90 dark:text-amber-100/90",children:[e.jsxs("span",{children:["سال: ",o(t.year)]}),e.jsxs("span",{children:["اینتاکد:"," ",t.intacode?o(t.intacode):"—"]}),e.jsxs("span",{children:["نوع شغل: ",t.jobType||"—"]}),e.jsxs("span",{children:["سود فعالیت:"," ",t.profit?o(t.profit):"—"]}),e.jsxs("span",{children:["نسبت سود ناویژه:"," ",t.margin?o(t.margin):"—"]}),t.notes&&t.notes.trim().length>0&&e.jsxs("span",{className:"basis-full",children:["ملاحظات: ",t.notes]}),e.jsx("button",{type:"button",onClick:()=>Q(t),className:"mt-1 px-2 py-1 rounded bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900/40 dark:text-red-200",children:"حذف"})]})]},t.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto mt-2 md:mt-0",children:e.jsxs("table",{className:"w-full text-xs border border-amber-200 dark:border-amber-500 rounded-md overflow-hidden",children:[e.jsx("thead",{className:"bg-amber-100 dark:bg-amber-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-right",children:"سال"}),e.jsx("th",{className:"p-2 text-right",children:"اینتاکد"}),e.jsx("th",{className:"p-2 text-right",children:"شرح فعالیت"}),e.jsx("th",{className:"p-2 text-right",children:"نوع شغل"}),e.jsx("th",{className:"p-2 text-right whitespace-nowrap",children:"سود فعالیت"}),e.jsx("th",{className:"p-2 text-right whitespace-nowrap",children:"نسبت سود ناویژه"}),X&&e.jsx("th",{className:"p-2 text-right",children:"ملاحظات"}),e.jsx("th",{className:"p-2 text-right",children:"حذف"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-900",children:B.map(t=>e.jsxs("tr",{className:"border-t border-amber-100 dark:border-amber-700",children:[e.jsx("td",{className:"p-2 text-xs",children:o(t.year)}),e.jsx("td",{className:"p-2 text-xs",children:t.intacode?o(t.intacode):"—"}),e.jsx("td",{className:"p-2 text-xs",children:t.title||"—"}),e.jsx("td",{className:"p-2 text-xs",children:t.jobType||"—"}),e.jsx("td",{className:"p-2 text-xs",children:t.profit?o(t.profit):"—"}),e.jsx("td",{className:"p-2 text-xs",children:t.margin?o(t.margin):"—"}),X&&e.jsx("td",{className:"p-2 text-xs",children:t.notes?t.notes:"—"}),e.jsx("td",{className:"p-2 text-xs",children:e.jsx("button",{type:"button",onClick:()=>Q(t),className:"px-2 py-1 rounded bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900/40 dark:text-red-200 text-[11px]",children:"حذف"})})]},t.id))})]})})]}),e.jsxs("section",{className:"mb-3 flex flex-col md:flex-row md:items-end md:justify-between gap-3",children:[e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"سال داده‌ها"}),e.jsxs("select",{value:n,onChange:ne,className:"w-full border rounded-lg px-2 py-2 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-[#B50000] dark:bg-[#0f172a] dark:text-gray-100 dark:border-gray-700",children:[e.jsx("option",{value:1402,children:"۱۴۰۲"}),e.jsx("option",{value:1403,children:"۱۴۰۳"})]})]}),e.jsx("div",{className:"w-full md:w-auto flex items-end justify-start md:justify-end",children:e.jsx("button",{type:"button",onClick:()=>T(t=>!t),className:"px-4 py-2 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-100 text-gray-700 dark:bg-slate-800 dark:border-gray-600 dark:text-gray-100 dark:hover:bg-slate-700",children:J?"بستن تنظیمات پیشرفته":"تنظیمات پیشرفته"})})]}),J&&e.jsxs("section",{className:"mb-4 grid grid-cols-1 md:grid-cols-4 gap-3 items-start border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-gray-50 dark:bg-slate-900/40",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"فیلتر نوع شغل"}),e.jsx("div",{className:"flex flex-col gap-1 text-xs",children:pe.map(t=>e.jsxs("label",{className:"inline-flex items-center gap-2 text-gray-700 dark:text-gray-200",children:[e.jsx("input",{type:"checkbox",checked:f[t],onChange:xe(t),className:"h-4 w-4 rounded border-gray-300 text-[#B50000] focus:ring-[#B50000]"}),e.jsx("span",{children:t})]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"نوع بازرگانی (بازرگانی)"}),e.jsx("div",{className:"flex flex-col gap-1 text-xs",children:je.map(t=>e.jsxs("label",{className:"inline-flex items-center gap-2 text-gray-700 dark:text-gray-200",children:[e.jsx("input",{type:"checkbox",checked:y[t],onChange:ge(t),className:"h-4 w-4 rounded border-gray-300 text-[#B50000] focus:ring-[#B50000]"}),e.jsxs("span",{children:["عدم نمایش ",t]})]},t))}),e.jsx("p",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:"این تیک‌ها فقط روی ردیف‌هایی اعمال می‌شوند که نوع شغل آن‌ها «بازرگانی» است."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"نوع کالا (بازرگانی)"}),e.jsx("div",{className:"flex flex-col gap-1 text-xs",children:fe.map(t=>e.jsxs("label",{className:"inline-flex items-center gap-2 text-gray-700 dark:text-gray-200",children:[e.jsx("input",{type:"checkbox",checked:N[t],onChange:he(t),className:"h-4 w-4 rounded border-gray-300 text-[#B50000] focus:ring-[#B50000]"}),e.jsx("span",{children:t})]},t))}),e.jsx("p",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:"این فیلتر فقط برای ردیف‌های با نوع شغل «بازرگانی» فعال است."})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"مرتب‌سازی بر اساس"}),e.jsxs("select",{value:w,onChange:le,className:"w-full border rounded-lg px-2 py-2 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-[#B50000] dark:bg-[#0f172a] dark:text-gray-100 dark:border-gray-700",children:[e.jsx("option",{value:"intacode",children:"اینتاکد"}),e.jsx("option",{value:"title",children:"شرح فعالیت"}),e.jsx("option",{value:"profit",children:"سود فعالیت"}),e.jsx("option",{value:"margin",children:"نسبت سود ناویژه"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:k,onChange:de,className:"flex-1 border rounded-lg px-2 py-2 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-[#B50000] dark:bg-[#0f172a] dark:text-gray-100 dark:border-gray-700",children:[e.jsx("option",{value:"asc",children:"صعودی"}),e.jsx("option",{value:"desc",children:"نزولی"})]}),e.jsx("button",{type:"button",onClick:oe,className:"whitespace-nowrap px-3 py-2 rounded-lg text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-gray-100",children:"ریست تنظیمات"})]})]})]}),e.jsxs("section",{className:"mb-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"text",placeholder:"جستجو در کد اینتاکد، شرح فعالیت یا کلمات مرتبط… (حداقل ۲ کاراکتر)",value:l,onChange:ae,className:"w-full border rounded-lg p-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#B50000] dark:bg-[#0f172a] dark:text-gray-100 dark:border-gray-700",dir:"rtl","aria-label":"کادر جستجوی اینتاکد"})}),p&&e.jsx("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:p})]}),q&&!p&&e.jsx("div",{className:"mb-2 text-xs text-gray-600 dark:text-gray-300",children:C>0?e.jsxs("span",{children:[o(C)," نتیجه برای جستجوی"," ",e.jsxs("span",{className:"font-semibold",children:["«",l,"»"]})," در سال"," ",o(n)," یافت شد."]}):e.jsxs("span",{children:["هیچ موردی برای جستجوی «",l,"» در سال"," ",o(n)," یافت نشد."]})}),q&&!p&&e.jsx(e.Fragment,{children:C>0?e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"overflow-x-auto border border-gray-300 rounded-lg dark:border-gray-700",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-200 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-right",children:"اینتاکد"}),e.jsx("th",{className:"p-2 text-right",children:"شرح فعالیت"}),e.jsx("th",{className:"p-2 text-right hidden sm:table-cell",children:"نوع شغل"}),e.jsxs("th",{className:"p-2 text-right whitespace-nowrap",children:["سود فعالیت ",o(n)]}),e.jsx("th",{className:"p-2 text-right whitespace-nowrap hidden md:table-cell",children:"نسبت سود ناویژه"}),e.jsx("th",{className:"p-2 text-right",children:"منتخب"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-900",children:re.map(t=>{const a=!!j[t.id],c=t.notes&&t.notes.trim().length>0;return e.jsxs("tr",{className:"border-t hover:bg-gray-50 dark:hover:bg-slate-800 dark:border-gray-700",children:[e.jsx("td",{className:"p-2 align-top",children:t.intacode?o(t.intacode):"—"}),e.jsx("td",{className:"p-2 align-top",children:t.title||"—"}),e.jsx("td",{className:"p-2 hidden sm:table-cell align-top",children:t.jobType||"—"}),e.jsxs("td",{className:"p-2 align-top",children:[e.jsx("span",{children:t.profit?o(t.profit):"—"}),c&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>me(t.id),className:"mr-2 inline-flex items-center text-[10px] px-1.5 py-0.5 rounded-full bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-200",children:"ملاحظات"}),_===t.id&&e.jsx("div",{className:"mt-1 text-[11px] text-amber-900 dark:text-amber-200 leading-snug",children:t.notes})]})]}),e.jsx("td",{className:"p-2 hidden md:table-cell align-top",children:e.jsx("span",{children:t.margin?o(t.margin):"—"})}),e.jsx("td",{className:"p-2 align-top",children:e.jsx("button",{type:"button",onClick:()=>Q(t),className:`px-2 py-1 rounded text-xs ${a?"bg-emerald-100 text-emerald-700 hover:bg-emerald-200 dark:bg-emerald-900/40 dark:text-emerald-200":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-slate-700 dark:text-gray-100"}`,children:a?"حذف از منتخب":"افزودن"})})]},t.id)})})]})}),I>1&&e.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-gray-700 dark:text-gray-200",children:[e.jsxs("div",{children:["نمایش"," ",e.jsxs("span",{className:"font-semibold",children:[o(H+1),"–",o(Math.min(W,C))]})," ","از"," ",e.jsx("span",{className:"font-semibold",children:o(C)})," ","نتیجه"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:ce,disabled:Y===1,className:"px-3 py-1 rounded border text-xs disabled:opacity-50 disabled:cursor-not-allowed border-gray-300 hover:bg-gray-100 dark:border-gray-600 dark:hover:bg-slate-700",children:"قبلی"}),e.jsxs("span",{children:["صفحه"," ",e.jsx("span",{className:"font-semibold",children:o(Y)})," ","از"," ",e.jsx("span",{className:"font-semibold",children:o(I)})]}),e.jsx("button",{type:"button",onClick:ie,disabled:Y===I,className:"px-3 py-1 rounded border text-xs disabled:opacity-50 disabled:cursor-not-allowed border-gray-300 hover:bg-gray-100 dark:border-gray-600 dark:hover:bg-slate-700",children:"بعدی"})]})]})]}):e.jsx("p",{className:"mt-4 text-sm text-gray-600 dark:text-gray-300",children:"هیچ موردی یافت نشد."})}),!q&&!p&&e.jsx("p",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:"برای نمایش نتایج، حداقل ۲ کاراکتر در کادر جستجو وارد کنید."})]})};export{ke as default};
