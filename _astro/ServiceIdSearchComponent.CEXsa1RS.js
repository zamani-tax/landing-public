import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.DiEladB3.js";function o(a=""){return String(a).trim().replace(/\u200c/g,"").replace(/[ي]/g,"ی").replace(/[ك]/g,"ک").replace(/[۰-۹]/g,r=>String("۰۱۲۳۴۵۶۷۸۹".indexOf(r))).toLowerCase()}function c(a){return a==null?"—":String(a).replace(/\d/g,r=>"۰۱۲۳۴۵۶۷۸۹"[parseInt(r,10)])}function de(a){const r={};for(const h of Object.keys(a||{})){const s=h.trim(),i=a[h];r[s]=typeof i=="string"?i.trim():i}return r}function ne(a){if(!a)return null;const h=o(a).replace(/[^\d.-]/g,""),s=parseFloat(h);return Number.isNaN(s)?null:s}function ce(a){if(a==null)return"";const r=String(a).trim();return/^\d+\.0$/.test(r)?r.slice(0,-2):r}function oe(a){if(a==null)return"";const r=String(a).trim();return/^\d+\.0$/.test(r)?r.slice(0,-2):r}function ie(a){const r=de(a),h=Object.entries(r).map(([m,T])=>[o(m),m,T]),s=m=>{const T=h.find(([te])=>m.every(se=>te.includes(se)));return T?T[1]:null},i=s(["id"])||s(["شناسه"])||s(["service","id"]),V=s(["description","id"])||s(["شرح","خدمت"])||s(["شرح"]),f=s(["vat"])||s(["مالیات","ارزش"])||s(["درصد","vat"]),P=s(["type"])||s(["نوع"]),N=s(["taxable"])||s(["مشمول"]),A=s(["rundate"])||s(["run","date"])||s(["تاریخ","اجرا"]),v=s(["lasteditdate"])||s(["last","edit","date"])||s(["آخرین","ویرایش"]),M=s(["expirationdate"])||s(["انقضا"]),b=s(["createdate"])||s(["create","date"])||s(["تاریخ","ایجاد"]),F=s(["vatcustompurposes"])||s(["vat","custom"])||s(["کاربرد","خاص"]),$=s(["pricingdescription"])||s(["pricing","description"])||s(["ملاحظات"])||s(["توضیحات"]),w=i?r[i]:"",S=V?r[V]:"",z=f?r[f]:"",L=P?r[P]:"",D=N?r[N]:"",q=A?r[A]:"",Q=v?r[v]:"",G=M?r[M]:"",I=b?r[b]:"",B=F?r[F]:"",O=$?r[$]:"",g=ce(w),k=S!=null?String(S):"",C=oe(z),_=L!=null?String(L):"",K=D!=null?String(D):"",X=q!=null?String(q):"",R=Q!=null?String(Q):"",p=G!=null?String(G):"",H=I!=null?String(I):"",Y=B!=null?String(B):"",Z=O!=null?String(O):"",ee=[Y,Z].map(m=>(m||"").trim()).filter(Boolean).join(" — ");return{id:o(g)||Math.random().toString(36).slice(2),serviceId:g,title:k,vat:C,type:_,taxable:K,runDate:X,lastEditDate:R,expirationDate:p,createDate:H,notes:ee,__raw:r}}const le=["مشمول","غیر مشمول","معاف"],ge=()=>{const[a,r]=d.useState(""),[h,s]=d.useState([]),[i,V]=d.useState(""),[f,P]=d.useState(!0),[N,A]=d.useState({مشمول:!0,"غیر مشمول":!0,معاف:!0}),[v,M]=d.useState("serviceId"),[b,F]=d.useState("asc"),[$,w]=d.useState(1),S=40,[z,L]=d.useState(!1),[D,q]=d.useState({}),[Q,G]=d.useState(null);d.useEffect(()=>{fetch("/search_service_id.json").then(t=>{if(!t.ok)throw new Error("خطا در دریافت search_service_id.json");return t.json()}).then(t=>{let l=[];Array.isArray(t)?l=t:Array.isArray(t?.data)?l=t.data:typeof t=="object"&&(l=Object.values(t)),s(l),V("")}).catch(t=>{console.error(t),V("خطا در بارگذاری داده‌ها. مسیر /search_service_id.json را بررسی کنید.")})},[]);const I=d.useMemo(()=>h.map(ie),[h]);d.useEffect(()=>{w(1)},[a,f,N,v,b,I.length]);const B=t=>{switch(v){case"serviceId":return ne(t.serviceId)??t.serviceId;case"title":return t.title||"";case"vat":return ne(t.vat)??t.vat;case"runDate":return t.runDate||"";case"lastEditDate":return t.lastEditDate||"";default:return null}},O=d.useMemo(()=>{const l=o(a).split(/\s+/).filter(Boolean),j=l.length>0;let E=I;if(f){const n=o("شناسه عمومی خدمت");E=E.filter(x=>o(x.type)===n)}const ae=le.filter(n=>N[n]);ae.length>0?E=E.filter(n=>{const x=n.taxable||"";return x&&ae.includes(x)}):E=[];let U=E.map(n=>{const x=[o(n.serviceId),o(n.title),o(n.vat),o(n.type),o(n.taxable),o(n.runDate),o(n.lastEditDate),o(n.expirationDate),o(n.createDate),o(n.notes)].join(" "),y=j?l.reduce((u,W)=>x.includes(W)?u+1:u,0):0;return{item:n,score:y}});return j&&(U=U.filter(n=>n.score>0)),U.sort((n,x)=>{if(j&&n.score!==x.score)return x.score-n.score;const y=B(n.item),u=B(x.item);if(y==null&&u==null)return 0;if(y==null)return 1;if(u==null)return-1;if(typeof y=="number"&&typeof u=="number")return b==="asc"?y-u:u-y;const W=String(y).localeCompare(String(u),"fa",{numeric:!0,sensitivity:"base"});return b==="asc"?W:-W}),U.map(n=>n.item)},[I,a,f,N,v,b]),g=O.length,k=Math.max(1,Math.ceil(g/S)),C=Math.min($,k),_=(C-1)*S,K=_+S,X=O.slice(_,K),R=a.trim().length>1,p=d.useMemo(()=>Object.values(D),[D]),H=d.useMemo(()=>p.some(t=>t.notes&&t.notes.trim().length>0),[p]),Y=t=>{r(t.target.value)},Z=t=>{M(t.target.value)},re=t=>{F(t.target.value)},ee=()=>{r(""),P(!0),A({مشمول:!0,"غیر مشمول":!0,معاف:!0}),M("serviceId"),F("asc"),w(1)},J=t=>{q(l=>{if(l[t.id]){const j={...l};return delete j[t.id],j}return{...l,[t.id]:t}})},m=()=>{w(t=>Math.max(1,t-1))},T=()=>{w(t=>Math.min(k,t+1))},te=t=>{G(l=>l===t?null:t)},se=t=>{A(l=>({...l,[t]:!l[t]}))};return e.jsxs("div",{className:"w-full max-w-5xl mx-auto text-right",dir:"rtl",children:[p.length>0&&e.jsxs("section",{className:"mb-6 border border-amber-300 rounded-lg bg-amber-50 dark:bg-slate-800 dark:border-amber-500 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"font-semibold text-sm text-amber-900 dark:text-amber-200",children:"شناسه‌های خدمت منتخب شما"}),e.jsxs("span",{className:"text-xs text-amber-800 dark:text-amber-300",children:["تعداد: ",c(p.length)]})]}),e.jsx("div",{className:"block md:hidden space-y-2",children:p.map(t=>e.jsxs("div",{className:"border border-amber-200 dark:border-amber-500 rounded-md bg-white dark:bg-slate-900 p-2 text-[11px]",children:[e.jsx("div",{className:"font-medium text-amber-900 dark:text-amber-100 mb-1",children:t.title||"—"}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1 text-amber-900/90 dark:text-amber-100/90",children:[e.jsxs("span",{children:["شناسه:"," ",t.serviceId?c(t.serviceId):"—"]}),e.jsxs("span",{children:["نوع: ",t.type||"—"]}),e.jsxs("span",{children:["وضعیت: ",t.taxable||"—"]}),e.jsxs("span",{children:["VAT:"," ",t.vat?`${c(t.vat)}٪`:"—"]}),e.jsxs("span",{children:["تاریخ اجرا:"," ",t.runDate?c(t.runDate):"—"]}),t.notes&&t.notes.trim().length>0&&e.jsxs("span",{className:"basis-full",children:["ملاحظات: ",t.notes]}),e.jsx("button",{type:"button",onClick:()=>J(t),className:"mt-1 px-2 py-1 rounded bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900/40 dark:text-red-200",children:"حذف"})]})]},t.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto mt-2 md:mt-0",children:e.jsxs("table",{className:"w-full text-xs border border-amber-200 dark:border-amber-500 rounded-md overflow-hidden",children:[e.jsx("thead",{className:"bg-amber-100 dark:bg-amber-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-right",children:"شناسه خدمت"}),e.jsx("th",{className:"p-2 text-right",children:"شرح خدمت"}),e.jsx("th",{className:"p-2 text-right",children:"نوع"}),e.jsx("th",{className:"p-2 text-right",children:"وضعیت مالیاتی"}),e.jsx("th",{className:"p-2 text-right",children:"VAT"}),H&&e.jsx("th",{className:"p-2 text-right",children:"ملاحظات"}),e.jsx("th",{className:"p-2 text-right",children:"حذف"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-900",children:p.map(t=>e.jsxs("tr",{className:"border-t border-amber-100 dark:border-amber-700",children:[e.jsx("td",{className:"p-2 text-xs",children:t.serviceId?c(t.serviceId):"—"}),e.jsx("td",{className:"p-2 text-xs",children:t.title||"—"}),e.jsx("td",{className:"p-2 text-xs",children:t.type||"—"}),e.jsx("td",{className:"p-2 text-xs",children:t.taxable||"—"}),e.jsx("td",{className:"p-2 text-xs",children:t.vat?`${c(t.vat)}٪`:"—"}),H&&e.jsx("td",{className:"p-2 text-xs",children:t.notes?t.notes:"—"}),e.jsx("td",{className:"p-2 text-xs",children:e.jsx("button",{type:"button",onClick:()=>J(t),className:"px-2 py-1 rounded bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900/40 dark:text-red-200 text-[11px]",children:"حذف"})})]},t.id))})]})})]}),e.jsxs("section",{className:"mb-3 flex flex-col md:flex-row md:items-end md:justify-between gap-3",children:[e.jsxs("div",{className:"w-full md:w-2/3 space-y-2",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-200",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:t=>P(t.target.checked),className:"h-4 w-4 rounded border-gray-300 text-[#B50000] focus:ring-[#B50000]"}),"فقط نمایش شناسه‌های عمومی"]}),e.jsx("div",{className:"flex flex-wrap gap-2 text-xs",children:le.map(t=>e.jsx("button",{type:"button",onClick:()=>se(t),className:`px-3 py-1 rounded-full border text-xs ${N[t]?"bg-[#B50000] text-white border-[#B50000]":"bg-white text-gray-700 border-gray-300 dark:bg-slate-800 dark:text-gray-100 dark:border-gray-600"}`,children:t},t))})]}),e.jsx("div",{className:"w-full md:w-auto flex items-end justify-start md:justify-end",children:e.jsx("button",{type:"button",onClick:()=>L(t=>!t),className:"px-4 py-2 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-100 text-gray-700 dark:bg-slate-800 dark:border-gray-600 dark:text-gray-100 dark:hover:bg-slate-700",children:z?"بستن تنظیمات پیشرفته":"تنظیمات پیشرفته"})})]}),z&&e.jsxs("section",{className:"mb-4 grid grid-cols-1 md:grid-cols-3 gap-3 items-start border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-gray-50 dark:bg-slate-900/40",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"مرتب‌سازی بر اساس"}),e.jsxs("select",{value:v,onChange:Z,className:"w-full border rounded-lg px-2 py-2 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-[#B50000] dark:bg-[#0f172a] dark:text-gray-100 dark:border-gray-700",children:[e.jsx("option",{value:"serviceId",children:"شناسه خدمت"}),e.jsx("option",{value:"title",children:"شرح خدمت"}),e.jsx("option",{value:"vat",children:"VAT"}),e.jsx("option",{value:"runDate",children:"تاریخ اجرا"}),e.jsx("option",{value:"lastEditDate",children:"آخرین ویرایش"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"جهت مرتب‌سازی"}),e.jsxs("select",{value:b,onChange:re,className:"w-full border rounded-lg px-2 py-2 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-[#B50000] dark:bg-[#0f172a] dark:text-gray-100 dark:border-gray-700",children:[e.jsx("option",{value:"asc",children:"صعودی"}),e.jsx("option",{value:"desc",children:"نزولی"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{type:"button",onClick:ee,className:"w-full whitespace-nowrap px-3 py-2 rounded-lg text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-gray-100",children:"ریست تنظیمات"})})]}),e.jsxs("section",{className:"mb-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"text",placeholder:"جستجو در «شناسه»، «شرح خدمت»، «نوع»، «وضعیت مشمولیت»، «VAT» یا تاریخ‌ها… (حداقل ۲ کاراکتر)",value:a,onChange:Y,className:"w-full border rounded-lg p-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#B50000] dark:bg-[#0f172a] dark:text-gray-100 dark:border-gray-700",dir:"rtl","aria-label":"کادر جستجوی شناسه خدمت"})}),i&&e.jsx("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:i})]}),R&&!i&&e.jsx("div",{className:"mb-2 text-xs text-gray-600 dark:text-gray-300",children:g>0?e.jsxs("span",{children:[c(g)," نتیجه برای جستجوی"," ",e.jsxs("span",{className:"font-semibold",children:["«",a,"»"]})," ","یافت شد."]}):e.jsxs("span",{children:["هیچ موردی برای جستجوی «",a,"» یافت نشد."]})}),R&&!i&&e.jsx(e.Fragment,{children:g>0?e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"overflow-x-auto border border-gray-300 rounded-lg dark:border-gray-700",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-200 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-right whitespace-nowrap",children:"شناسه خدمت"}),e.jsx("th",{className:"p-2 text-right",children:"شرح خدمت"}),e.jsx("th",{className:"p-2 text-right hidden sm:table-cell",children:"نوع"}),e.jsx("th",{className:"p-2 text-right hidden md:table-cell whitespace-nowrap",children:"وضعیت مالیاتی"}),e.jsx("th",{className:"p-2 text-right whitespace-nowrap",children:"VAT"}),e.jsx("th",{className:"p-2 text-right hidden lg:table-cell whitespace-nowrap",children:"تاریخ اجرا"}),e.jsx("th",{className:"p-2 text-right hidden lg:table-cell whitespace-nowrap",children:"آخرین ویرایش"}),e.jsx("th",{className:"p-2 text-right",children:"منتخب"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-900",children:X.map(t=>{const l=!!D[t.id],j=t.notes&&t.notes.trim().length>0;return e.jsxs("tr",{className:"border-t hover:bg-gray-50 dark:hover:bg-slate-800 dark:border-gray-700",children:[e.jsx("td",{className:"p-2 align-top",children:t.serviceId?c(t.serviceId):"—"}),e.jsxs("td",{className:"p-2 align-top",children:[t.title||"—",j&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>te(t.id),className:"mr-2 mt-1 inline-flex items-center text-[10px] px-1.5 py-0.5 rounded-full bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-200",children:"ملاحظات"}),Q===t.id&&e.jsx("div",{className:"mt-1 text-[11px] text-amber-900 dark:text-amber-200 leading-snug",children:t.notes})]})]}),e.jsx("td",{className:"p-2 hidden sm:table-cell align-top",children:t.type||"—"}),e.jsx("td",{className:"p-2 hidden md:table-cell align-top",children:t.taxable||"—"}),e.jsx("td",{className:"p-2 align-top",children:t.vat?`${c(t.vat)}٪`:"—"}),e.jsx("td",{className:"p-2 hidden lg:table-cell align-top",children:t.runDate?c(t.runDate):"—"}),e.jsx("td",{className:"p-2 hidden lg:table-cell align-top",children:t.lastEditDate?c(t.lastEditDate):"—"}),e.jsx("td",{className:"p-2 align-top",children:e.jsx("button",{type:"button",onClick:()=>J(t),className:`px-2 py-1 rounded text-xs ${l?"bg-emerald-100 text-emerald-700 hover:bg-emerald-200 dark:bg-emerald-900/40 dark:text-emerald-200":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-slate-700 dark:text-gray-100"}`,children:l?"حذف از منتخب":"افزودن"})})]},t.id)})})]})}),k>1&&e.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-gray-700 dark:text-gray-200",children:[e.jsxs("div",{children:["نمایش"," ",e.jsxs("span",{className:"font-semibold",children:[c(_+1),"–",c(Math.min(K,g))]})," ","از"," ",e.jsx("span",{className:"font-semibold",children:c(g)})," ","نتیجه"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:m,disabled:C===1,className:"px-3 py-1 rounded border text-xs disabled:opacity-50 disabled:cursor-not-allowed border-gray-300 hover:bg-gray-100 dark:border-gray-600 dark:hover:bg-slate-700",children:"قبلی"}),e.jsxs("span",{children:["صفحه"," ",e.jsx("span",{className:"font-semibold",children:c(C)})," ","از"," ",e.jsx("span",{className:"font-semibold",children:c(k)})]}),e.jsx("button",{type:"button",onClick:T,disabled:C===k,className:"px-3 py-1 rounded border text-xs disabled:opacity-50 disabled:cursor-not-allowed border-gray-300 hover:bg-gray-100 dark:border-gray-600 dark:hover:bg-slate-700",children:"بعدی"})]})]})]}):e.jsx("p",{className:"mt-4 text-sm text-gray-600 dark:text-gray-300",children:"هیچ موردی یافت نشد."})}),!R&&!i&&e.jsx("p",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:"برای نمایش نتایج، حداقل ۲ کاراکتر در کادر جستجو وارد کنید."})]})};export{ge as default};
