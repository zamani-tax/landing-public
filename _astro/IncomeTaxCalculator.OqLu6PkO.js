import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.RH_Wq4ov.js";const fe={0:"۰",1:"۱",2:"۲",3:"۳",4:"۴",5:"۵",6:"۶",7:"۷",8:"۸",9:"۹"},v=l=>l.replace(/[0-9]/g,c=>fe[c]??c),Ae=l=>l.replace(/[۰-۹]/g,c=>String("۰۱۲۳۴۵۶۷۸۹".indexOf(c))),mt=l=>{const c={};return Object.entries(fe).forEach(([r,d])=>c[d]=r),l.replace(/[۰-۹]/g,r=>c[r]??r)},je=l=>{if(!l)return 0;const c=mt(l).replace(/[,%\s\u200c\u200e\u200f]/g,""),r=Number(c);return Number.isFinite(r)?r:0},x=l=>{const c=l<0?"-":"",r=Math.abs(Math.round(l)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");return v(c+r)},V=[{cap:2e8,rate:.15},{cap:4e8,rate:.2},{cap:1/0,rate:.25}],xt=.25,W=2e9;function ye(l){let c=Math.max(0,l),r=0;for(let d=0;d<V.length&&c>0;d++){const A=d===0?0:V[d-1].cap,u=V[d].cap-A,y=Math.min(c,Number.isFinite(u)?u:c);r+=y*V[d].rate,c-=y}return r}function ht(l,c=xt){return Math.max(0,l)*c}const E=(l="")=>Ae(String(l)).trim().replace(/\u200c/g,"").replace(/[ي]/g,"ی").replace(/[ك]/g,"ک").toLowerCase(),Se=l=>{if(l==null)return 0;let c=String(l).trim();c=Ae(c);const r=/%|٪/.test(c);c=c.replace(/[^\d.]/g,"");const d=Number(c||0);return Number.isFinite(d)?r||d>1?d/100:d:0},ut=l=>{const c=Object.keys(l||{}),r=(...S)=>{const I=c.find(f=>{const q=E(f);return S.some(M=>q.includes(E(M)))});return I?l[I]:void 0},d=String(r("intacode","code","کد","اینتاکد")??"").trim(),A=String(r("title","شرح","فعالیت","activity","عنوان")??"").trim(),u=Se(r("profit1402","سود 1402","سود۱۴۰۲","نسبت سود فعالیت","activitymargin")),y=Se(r("margin","نسبت سود ناویژه","grossmargin"));return{code:d,title:A,activityMargin:u,grossMargin:y}},Nt=()=>{const[l,c]=a.useState("حقوقی"),r=l==="حقیقی",[d,A]=a.useState(0),[u,y]=a.useState(0),[S,I]=a.useState(0),[f,q]=a.useState(0),[M,Me]=a.useState(0),[z,Ce]=a.useState(0),[F,Pe]=a.useState(0),[O,ke]=a.useState(0),[H,Te]=a.useState(0),[J,De]=a.useState(0),[te,Ge]=a.useState(0),[se,we]=a.useState(0),[ae,Ee]=a.useState(0),[R,Ie]=a.useState(0),[B,Fe]=a.useState(0),[K,Oe]=a.useState(0),[Q,Re]=a.useState(0),[re,Be]=a.useState(0),[ce,Le]=a.useState(0),[ne,Ue]=a.useState(0),[le,_e]=a.useState(0),[ie,Ve]=a.useState(0),[oe,We]=a.useState(0),[de,qe]=a.useState(0),[me,ze]=a.useState(0),[xe,He]=a.useState(0),[pt,Je]=a.useState([]),[he,Ke]=a.useState([]);a.useEffect(()=>{fetch("/intacode.json").then(t=>t.json()).then(t=>{let s=[];Array.isArray(t)?s=t:Array.isArray(t?.data)?s=t.data:t&&typeof t=="object"&&(s=Object.values(t)),Je(s),Ke(s.map(ut).filter(m=>m.code))}).catch(console.error)},[]);const[Qe,X]=a.useState([{code:"",title:"",activityMargin:void 0,grossMargin:void 0,incomeAssigned:0},{code:"",title:"",activityMargin:void 0,grossMargin:void 0,incomeAssigned:0}]),[Xe,Y]=a.useState(null),Ye=t=>{const s=E(t);return s?he.filter(m=>E(m.code).includes(s)||E(m.title).includes(s)).slice(0,8):[]},[ue,Ze]=a.useState(0),[b,Z]=a.useState(!1),[N,C]=a.useState([{id:"p1",name:"شریک 1",sharePct:100,isSpouse:!1}]),L=d+u,$e=S+f,et=Math.max(0,L-$e),P=Math.max(0,et-M+z),pe=F+O,ge=R+B,tt=le+ie,st=oe+de,ve=Math.max(0,tt-st),at=Math.max(0,ve-me+xe);function rt(t){const s=he.find(m=>(m.code||"").trim()===(t.code||"").trim());return s?{...t,title:s.title,activityMargin:s.activityMargin,grossMargin:s.grossMargin}:{...t,title:"",activityMargin:void 0,grossMargin:void 0}}const U=Qe.map(rt),$=U.reduce((t,s)=>t+(s.incomeAssigned||0),0),ct=a.useMemo(()=>$<=0?0:U.reduce((t,s)=>t+s.incomeAssigned*(s.activityMargin||0),0)/$,[U,$]),p=Math.max(0,L*(ct||0)),nt=pe>0?L/pe*ae:0,lt=ge>0?L/ge*ne:0,_=r&&b?N.length:1,it=_===2&&r&&b&&N.every(t=>!!t.isSpouse),ee=r?b&&_>=2?it?W:2*W:W:0,ot=r&&b&&_>0?Math.floor(ee/_):ee;function k(t){let s=Math.max(0,t-ue);if(!r){const o=ht(s);return{taxableAfter101:s,totalTax:o}}if(!b){const o=Math.max(0,s-ee),h=ye(o);return{taxableAfter101:o,totalTax:h}}const m=N.reduce((o,h)=>o+(h.sharePct||0),0)||100,n=N.map(o=>{const h=s*(o.sharePct||0)/m,be=ot,Ne=Math.max(0,h-be),dt=ye(Ne);return{id:o.id,name:o.name,pct:o.sharePct,isSpouse:!!o.isSpouse,shareAmount:h,artShare:be,taxable:Ne,tax:dt}}),g=n.reduce((o,h)=>o+h.tax,0);return{taxableAfter101:n.reduce((o,h)=>o+h.taxable,0),totalTax:g,partnerRows:n}}const T={key:"act",label:"بر اساس نسبت فعالیت",baseNet:p,...k(p)},D={key:"ideal",label:"حداقل شرایط ایده آلی ممیز",baseNet:Math.min(P,p),...k(Math.min(P,p))},G={key:"prop",label:"تناسب با سال گذشته",baseNet:P,taxableAfter101:P,totalTax:Math.round(Math.max(nt,lt))},w={key:"sugg",label:"پیشنهاد ما برای ابرازی",baseNet:r?k(p).taxableAfter101??p:p,totalTax:Math.round((k(p).totalTax||0)*.4)};({...k(P)});const i=(t,s,m="0")=>e.jsx("input",{type:"text",inputMode:"numeric",dir:"ltr",className:"w-full rounded-xl border bg-[var(--color-input-background)] px-3 py-2 text-right",value:v(t.toLocaleString("en-US")),placeholder:v(m),onChange:n=>s(je(n.target.value))});return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"grid gap-4 md:grid-cols-3 bg-card border rounded-2xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"shrink-0",children:"نوع مودی:"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"taxpayer",checked:l==="حقیقی",onChange:()=>{c("حقیقی"),Z(!1)}}),e.jsx("span",{children:"حقیقی"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"taxpayer",checked:l==="حقوقی",onChange:()=>{c("حقوقی"),Z(!1)}}),e.jsx("span",{children:"حقوقی"})]})]})]})}),e.jsxs("div",{className:"border rounded-2xl p-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"جدول اطلاعات پایه"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-2 text-right w-40",children:"عنوان"}),e.jsx("th",{className:"py-2 text-right",children:"امسال"}),e.jsx("th",{className:"py-2 text-right",children:"ابرازی سال گذشته"}),e.jsx("th",{className:"py-2 text-right",children:"تشخیصی سال گذشته"}),e.jsx("th",{className:"py-2 text-right",children:"خودم"})]})}),e.jsx("tbody",{children:[["فروش کالا",i(d,A),i(F,Pe),i(R,Ie),i(le,_e)],["فروش خدمات",i(u,y),i(O,ke),i(B,Fe),i(ie,Ve)],["بهای تمام شده کالا",i(S,I),i(H,Te),i(K,Oe),i(oe,We)],["بهای تمام شده خدمات",i(f,q),i(J,De),i(Q,Re),i(de,qe)],["هزینه های اداری عمومی",i(M,Me),i(te,Ge),i(re,Be),i(me,ze)],["درآمدهای معاف (+)",i(z,Ce),i(se,we),i(ce,Le),i(xe,He)],["سود ناخالص",x(Math.max(0,d+u-(S+f))),x(Math.max(0,F+O-(H+J))),x(Math.max(0,R+B-(K+Q))),x(ve)],["سود خالص",x(Math.max(0,d+u-(S+f)-M+z)),x(Math.max(0,F+O-(H+J)-te+se)),x(Math.max(0,R+B-(K+Q)-re+ce)),x(at)],["مالیات نهایی سال گذشته","—",i(ae,Ee),i(ne,Ue),"—"]].map((t,s)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2",children:t[0]}),e.jsx("td",{className:"py-2",children:t[1]}),e.jsx("td",{className:"py-2",children:t[2]}),e.jsx("td",{className:"py-2",children:t[3]}),e.jsx("td",{className:"py-2",children:t[4]})]},s))})]})})]}),e.jsxs("div",{className:"bg-card border rounded-2xl p-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"نسبت های سود فعالیت (اینتاکد)"}),e.jsx("div",{className:"grid gap-2",children:U.map((t,s)=>{const m=Ye(t.code);return e.jsxs("div",{className:"grid items-center gap-2 md:grid-cols-12",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("input",{className:"w-full rounded-lg border bg-[var(--color-input-background)] px-2 py-2 text-right",dir:"ltr",placeholder:v("کد"),value:t.code,onChange:n=>{const g=n.target.value.trim();X(j=>j.map((o,h)=>h===s?{...o,code:g}:o)),Y(g?s:null)},onBlur:()=>setTimeout(()=>Y(null),180)}),Xe===s&&m.length>0&&e.jsx("div",{className:"mt-1 border rounded-lg max-h-48 overflow-auto bg-[var(--color-input-background)] text-sm",children:m.map((n,g)=>e.jsx("button",{type:"button",className:"w-full text-right px-2 py-1 hover:bg-accent",onMouseDown:()=>{X(j=>j.map((o,h)=>h===s?{...o,code:n.code||"",title:n.title||"",activityMargin:n.activityMargin||0,grossMargin:n.grossMargin||0}:o)),Y(null)},children:(n.code||"")+" — "+(n.title||"")},g))})]}),e.jsx("div",{className:"md:col-span-5",children:e.jsx("div",{className:"rounded-lg border bg-[var(--color-input-background)] px-2 py-2 truncate",children:t.title||"—"})}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"rounded-lg border bg-[var(--color-input-background)] px-2 py-2 text-right",children:[v(((t.activityMargin??0)*100).toFixed(0))," %"]})}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"rounded-lg border bg-[var(--color-input-background)] px-2 py-2 text-right",children:[v(((t.grossMargin??0)*100).toFixed(0))," %"]})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx("input",{type:"text",inputMode:"numeric",dir:"ltr",className:"w-full rounded-lg border bg-[var(--color-input-background)] px-2 py-2 text-right",value:v(t.incomeAssigned.toLocaleString("en-US")),onChange:n=>X(g=>g.map((j,o)=>o===s?{...j,incomeAssigned:je(n.target.value)}:j)),placeholder:v("درآمد منتسب")})})]},s)})}),e.jsx("div",{className:"mt-3 text-xs text-muted-foreground leading-relaxed",children:"نکته: نسبت سود ناویژه برای حقیقی های گروه دوم و سوم که دفاتر قانونی ندارند معمولا استفاده نمی شود."})]}),e.jsxs("div",{className:"border rounded-2xl p-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"معافیت ها (ورود دستی)"}),e.jsxs("div",{className:"max-w-md",children:[e.jsx("label",{className:"block mb-1",children:"کسر از درآمد مشمول"}),i(ue,Ze)]})]}),r&&e.jsxs("div",{className:"border rounded-2xl p-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"مشارکت"}),e.jsxs("label",{className:"inline-flex items-center gap-2 mb-3",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:t=>{Z(t.target.checked),t.target.checked&&N.length===1&&C([{id:"p1",name:"شریک 1",sharePct:50,isSpouse:!0},{id:"p2",name:"شریک 2",sharePct:50,isSpouse:!1}])}}),e.jsx("span",{children:"پرونده مشارکتی"})]}),b&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-2 text-right",children:"نام"}),e.jsx("th",{className:"py-2 text-right",children:"درصد"}),e.jsx("th",{className:"py-2 text-right",children:"زوج؟"}),e.jsx("th",{className:"py-2 text-right"})]})}),e.jsx("tbody",{children:N.map(t=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2",children:e.jsx("input",{className:"w-40 rounded-lg border bg-[var(--color-input-background)] px-2 py-1",value:t.name,onChange:s=>C(m=>m.map(n=>n.id===t.id?{...n,name:s.target.value}:n))})}),e.jsxs("td",{className:"py-2",children:[e.jsx("input",{type:"number",dir:"ltr",className:"w-24 text-right rounded-lg border bg-[var(--color-input-background)] px-2 py-1",value:t.sharePct,onChange:s=>C(m=>m.map(n=>n.id===t.id?{...n,sharePct:Number(s.target.value||0)}:n))})," %"]}),e.jsx("td",{className:"py-2 text-center",children:e.jsx("input",{type:"checkbox",checked:!!t.isSpouse,onChange:s=>C(m=>m.map(n=>n.id===t.id?{...n,isSpouse:s.target.checked}:n))})}),e.jsx("td",{className:"py-2 text-left",children:N.length>1&&e.jsx("button",{className:"text-destructive",onClick:()=>C(s=>s.filter(m=>m.id!==t.id)),children:"حذف"})})]},t.id))})]})}),e.jsx("div",{className:"mt-2 text-xs text-muted-foreground leading-relaxed",children:"سقف 101 سال 1404: انفرادی 2٬000٬000٬000 ریال؛ مشارکتی 4٬000٬000٬000 ریال؛ اگر دقیقا دو شریک و هر دو زوج باشند: 2٬000٬000٬000 ریال. در مشارکت، معافیت پرونده به صورت مساوی بین تمام شرکا تقسیم می شود."})]})]}),e.jsxs("div",{className:"border rounded-2xl p-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"خلاصه پیشنهادی"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-2 text-right w-48",children:"ستون"}),e.jsx("th",{className:"py-2 text-right",children:"سود خالص پایه"}),r&&e.jsx("th",{className:"py-2 text-right",children:"پس از اعمال 101 و دستی"}),e.jsx("th",{className:"py-2 text-right",children:"مالیات"})]})}),e.jsx("tbody",{children:[w,D,T,G].map(t=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2",children:t.label}),e.jsx("td",{className:"py-2",children:x(t.baseNet)}),r&&e.jsx("td",{className:"py-2",children:x(t.taxableAfter101??t.baseNet)}),e.jsx("td",{className:"py-2 font-medium",children:x(t.totalTax)})]},t.key))})]})})]}),e.jsxs("div",{className:"border rounded-2xl p-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"نتایج کلی"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-2 text-right w-44",children:"عنوان"}),e.jsx("th",{className:"py-2 text-right",children:"پیشنهاد ما برای ابرازی"}),e.jsx("th",{className:"py-2 text-right",children:"حداقل شرایط ایده آلی ممیز"}),e.jsx("th",{className:"py-2 text-right",children:"بر اساس نسبت فعالیت"}),e.jsx("th",{className:"py-2 text-right",children:"تناسب با سال گذشته"})]})}),e.jsx("tbody",{children:[["سود خالص پایه",w.baseNet,D.baseNet,T.baseNet,G.baseNet],...r?[["پس از اعمال 101 و دستی",w.taxableAfter101??w.baseNet,D.taxableAfter101??D.baseNet,T.taxableAfter101??T.baseNet,G.taxableAfter101??G.baseNet]]:[],["مالیات",w.totalTax,D.totalTax,T.totalTax,G.totalTax]].map((t,s)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2",children:t[0]}),e.jsx("td",{className:"py-2",children:x(t[1])}),e.jsx("td",{className:"py-2",children:x(t[2])}),e.jsx("td",{className:"py-2",children:x(t[3])}),e.jsx("td",{className:"py-2",children:x(t[4])})]},s))})]})})]})]})};export{Nt as default};
